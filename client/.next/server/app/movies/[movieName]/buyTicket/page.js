(()=>{var e={};e.id=7889,e.ids=[7889],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},71017:e=>{"use strict";e.exports=require("path")},57310:e=>{"use strict";e.exports=require("url")},76686:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var a=s(67096),n=s(16132),r=s(37284),i=s.n(r),l=s(32564),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["movies",{children:["[movieName]",{children:["buyTicket",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,47480)),"/Users/sravankumargorati/teamproject-infinite-loop/client/src/app/movies/[movieName]/buyTicket/page.tsx"]}]},{}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,79113)),"/Users/sravankumargorati/teamproject-infinite-loop/client/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/Users/sravankumargorati/teamproject-infinite-loop/client/src/app/movies/[movieName]/buyTicket/page.tsx"],u="/movies/[movieName]/buyTicket/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/movies/[movieName]/buyTicket/page",pathname:"/movies/[movieName]/buyTicket",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},18042:(e,t,s)=>{Promise.resolve().then(s.bind(s,28550))},28550:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>BuyTicket});var a=s(30784),n=s(9885),r=s.n(n),i=s(57114),l=s(66558),o=s(83894),c=s(19098),d=s(98331),u=s(39966),h=s.n(u),m=s(43872),p=s(33987),x=s.n(p),g=s(21971),_=s.n(g),f=s(92870),j=s.n(f),S=s(58111),v=s.n(S),y=s(97445),k=s.n(y),b=s(51892),w=s.n(b),P=s(88707),T=s.n(P),C=s(34550),D=s.n(C),E=s(16614),B=s.n(E),N=s(89440),q=s.n(N),R=s(84724),$=s.n(R),A=s(26017),F=s.n(A),W=s(16061),L=s.n(W),M=s(68101),O=s.n(M),G=s(52694),U=s.n(G),Z=s(77523),Q=s.n(Z),I=s(24608),X=s.n(I),Y=s(44233),z=s.n(Y),H=s(80765),V=s.n(H),J=s(15050),K=s(95150),ee=s.n(K),et=s(77625),es=s(65656),ea=s(83689),en=s.n(ea),er=s(14041),ei=s(23458);(0,er.J)("pk_test_51OEgQqA475w0fpJudMi36tfpe04jdRxLTraIo1nwDrPcvgdEhXz77lWWfloifqjrI7UsggP5JppqQvU1fg6hZsuB00ibyRUIcB");let el=c.Ry({date:c.hT().min(new Date("1900-01-01"),"Date is required").or(c.Z_().nonempty("Date is required")),theater:c.Z_().min(1,"Theater is required"),screen:c.Z_().min(1,"Screen is required"),timing:c.Z_().min(1,"Select at least one timing")}),eo={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function BuyTicket(){let{movieName:e}=(0,i.useParams)(),t=(0,i.useSearchParams)(),[s,c]=(0,n.useState)(!0),[u,p]=(0,n.useState)([]),[g,f]=(0,n.useState)([]),[S,y]=(0,n.useState)([]),[b,P]=(0,n.useState)(0),[C,E]=(0,n.useState)(),[N,R]=(0,n.useState)(),[A,W]=(0,n.useState)(),[M,G]=(0,n.useState)(!1),[Z,I]=(0,n.useState)({}),[Y,H]=(0,n.useState)([]),[K,ea]=(0,n.useState)(null),[er,ec]=(0,n.useState)(null),[ed,eu]=(0,n.useState)(""),[eh,em]=(0,n.useState)(!1),[ep,ex]=(0,n.useState)("false"),eg=`http://ec2-3-101-12-15.us-west-1.compute.amazonaws.com/api/payment/checkout_sessions/${ed}/${ep}`,[e_,ef]=(0,n.useState)(0),ej=(0,ei.Z)(),[eS,ev]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!eh){let e=t.get("theater"),s=t.get("screen"),a=t.get("time");if(e){eP("theater",e);let t=u.find(t=>t.id===e);if(t&&f(t.screen_details),s&&g.length>0){eP("screen",s);let e=g.find(e=>e.id===s);e&&y(e.show_timings),a&&(eP("timing",a),em(!0))}}}},[t,u,g]),(0,n.useEffect)(()=>{clearSelectedSeats();let fetchData=async()=>{try{let t=await (0,J.e)("",`theater/getAllTheatersScreens/${e}`,"GET");E(t.data.movieName),p(t.data.theaters),W(t.data.endDate);let s=en()(new Date),a=s>en()(t.data.releaseDate)?s:en()(t.data.releaseDate);R(a)}catch(e){console.log(e)}},fetchDiscountRates=async()=>{try{let e=await (0,J.e)("","discount/all","GET");ec(e.data)}catch(e){console.log(e)}},fetchRewardPoint=async()=>{try{let e=await (0,J.e)("",`user/getRewards/${ej.user.user_id}`,"GET");ef(e.data)}catch(e){console.log(e)}};fetchData(),fetchDiscountRates(),fetchRewardPoint()},[]);let clearSelectedSeats=()=>{let e={...Z};for(let e in Z)Z[e].forEach((t,s)=>{2===t&&(Z[e][s]=0)});I(e)},changeEditable=()=>{c(!s)};async function validateFileds(){ek();let t=ey();if(null!=t.date&&""!=t.screen&&""!=t.theater&&""!=t.timing){let s={theater_id:t.theater,screen_id:t.screen,movie_id:e,time:t.timing,value:t.date},a=await (0,J.e)(s,"screen/getScreenLayout","POST");H([]),I({...a.data.seatArray}),P(a.data.cost),changeEditable()}}let{getValues:ey,trigger:ek,control:eb,formState:{errors:ew},setValue:eP}=(0,l.cI)({resolver:(0,o.F)(el)}),getErrorMessage=e=>e&&"string"==typeof e.message?e.message:"",getSeatWithOffset=(e,t,s)=>{let a=0,n="";return Z[e].forEach((r,i)=>{r===s&&i===t?n=`${e}${i+1-a}`:3===r&&a++}),n},onSeatClick=(e,t,a)=>{if(!s){if(Z){if(1===e||3===e)return;if(0===e){if(Y.length>=8)return;Z[a][t]=2;let e=getSeatWithOffset(a,t,2);Y.push(e)}else{Z[a][t]=0;let e=getSeatWithOffset(a,t,0),s=Y.indexOf(e);s>-1&&Y.splice(s,1)}}H(Y),I({...Z})}},getClassNameForSeats=e=>{let t;return s?(t=ee().disableSeat,3==e&&(t=ee().seatBlocked)):t=0===e?ee().seatNotBooked:1===e?ee().seatBooked:2===e?ee().seatSelected:ee().seatBlocked,`${ee().seats} ${t}`},getReqSeatDeatils=()=>{let e={};for(let t in Z){let s=[];for(let e=0;e<Z[t].length;e++)2===Z[t][e]?s.push(1):s.push(Z[t][e]);e[t]=s}return e};async function onSubmit(){let t=ey(),s=t.date.day(),a=t.timing.split(" ")[1],n=null;n="pm"===a?(Number(n=t.timing.split(":")[0])+12).toString():t.timing.split(":")[0];let r=t.theater+"-"+t.screen+"-"+n+"-"+t.date,i="2"===s.toString()?er.tuesday_discount_percentage:null;n>=18&&(i=er.nighttime_discount_percentage);let l=null!=i?b*Y.length*(1-.01*i):b*Y.length;t.user_id=ej.user?ej.user.user_id:null,t.discount="2"===s.toString()?"tuesday":n>=18?"night_time":null,t.screenLayout=getReqSeatDeatils(),t.seatSelected=Y,t.movie_id=e,t.key=r,t.price=b,t.rewards=e_,t.is_prime=!1;let o=await (0,J.e)(t,"payment/storeTicketBookingDetails","POST");if(200===o.status){let e={ticketsBooked:Y.join(","),pricePerTicket:b,discount:"2"===s.toString()?`Tuesday's Discount ${i}%`:n>=18?`Night Show Discount ${i}%`:"0",totalPrice:l};ea(e),eu(r),ev(null),G(!0)}else 400===o.status&&(ev(o.message),G(!0))}return(0,a.jsxs)(r().Fragment,{children:[a.jsx(d.Z,{}),(0,a.jsxs)(h(),{maxWidth:!1,style:{marginLeft:"0px",marginRight:"0px",marginTop:"6%"},children:[(0,a.jsxs)("form",{children:[a.jsx(m.default,{sx:{display:"flex",justifyContent:"center"},children:(0,a.jsxs)(x(),{variant:"h4",children:["Book Ticket - ",C]})}),(0,a.jsxs)(_(),{container:!0,spacing:2,children:[a.jsx(_(),{sx:{display:"flex",justifyContent:"center",mt:"16px"},item:!0,xs:12,md:12,lg:3,children:a.jsx(l.Qr,{name:"date",control:eb,defaultValue:null,render:({field:e})=>a.jsx(et.LocalizationProvider,{dateAdapter:es.y,children:s?a.jsx(et.DatePicker,{disabled:!s,minDate:en()(N),maxDate:en()(A),sx:{width:"100%"},label:"Select Date",...e}):a.jsx(j(),{...e,label:"SelectDate",value:e.value?en()(e.value).format("MM/DD/YYYY"):"",disabled:!s,fullWidth:!0,variant:"outlined",InputLabelProps:{shrink:!!e.value}})})})}),a.jsx(_(),{item:!0,xs:12,md:12,lg:3,children:a.jsx(l.Qr,{name:"theater",control:eb,defaultValue:null,render:({field:e})=>(0,a.jsxs)(v(),{disabled:!s,fullWidth:!0,margin:"normal",error:!!ew.theater,children:[a.jsx(k(),{children:"Theater"}),a.jsx(w(),{...e,label:"Theater",onChange:t=>{e.onChange(t),u.forEach(e=>{e.id==t.target.value&&(eP("screen",null),eP("timing",null),f(e.screen_details),y([]))})},value:e.value||"",children:u.map(e=>a.jsx(T(),{value:e.id,children:e.name},e.id))}),a.jsx(D(),{id:"component-error-text",children:getErrorMessage(ew.theater)})]})})}),a.jsx(_(),{item:!0,xs:12,md:12,lg:3,children:a.jsx(l.Qr,{name:"screen",control:eb,defaultValue:null,render:({field:e})=>(0,a.jsxs)(v(),{disabled:!s,fullWidth:!0,margin:"normal",error:!!ew.screen,children:[a.jsx(k(),{children:"Screen"}),a.jsx(w(),{...e,label:"Screen",onChange:t=>{e.onChange(t),g.forEach(e=>{e.id==t.target.value&&y(e.show_timings)})},value:e.value||"",children:g.map(e=>a.jsx(T(),{value:e.id,children:e.name},e.id))}),a.jsx(D(),{id:"component-error-text",children:getErrorMessage(ew.screen)})]})})}),a.jsx(_(),{item:!0,xs:12,md:12,lg:3,children:a.jsx(l.Qr,{name:"timing",control:eb,defaultValue:"",render:({field:e})=>(0,a.jsxs)(v(),{disabled:!s,fullWidth:!0,margin:"normal",error:!!ew.timing,children:[a.jsx(k(),{children:"Timing"}),a.jsx(w(),{...e,label:"Timing",children:S.map(e=>a.jsx(T(),{value:e,children:e},e))}),a.jsx(D(),{id:"component-error-text",children:getErrorMessage(ew.timing)})]})})})]}),a.jsx(_(),{sx:{flexGrow:1},container:!0,spacing:2,children:a.jsx(_(),{item:!0,xs:12,lg:12,children:a.jsx(_(),{container:!0,justifyContent:"center",spacing:2,children:s?a.jsx(m.default,{gap:2,my:4,children:a.jsx(B(),{variant:"contained",onClick:validateFileds,children:"Apply Changes"})}):(0,a.jsxs)(m.default,{gap:2,my:4,children:[a.jsx(B(),{style:{marginRight:"5px"},variant:"outlined",onClick:changeEditable,children:"Change Theater"}),0!==Y.length&&(0,a.jsxs)(B(),{variant:"contained",onClick:()=>{onSubmit()},children:["Book Ticket Pay $",Y.length*(b||0)]})]})})})})]}),a.jsx(a.Fragment,{children:(0,a.jsxs)("div",{className:ee().seatsContainer,children:[Z?a.jsx(()=>{let e=[];for(let t in Z){let s=0,n=Z[t].map((e,n)=>(0,a.jsxs)("span",{className:ee().seatsHolder,children:[0===n&&a.jsx("span",{className:ee().colName,children:t}),3!=e?a.jsx("span",{className:getClassNameForSeats(e),onClick:()=>onSeatClick(e,n,t),children:s+=1}):a.jsx("span",{className:getClassNameForSeats(e),children:1}),Z&&n===Z[t].length-1&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("br",{}),a.jsx("br",{})]})]},`${t}.${n}`));e.push(n)}return a.jsx("div",{className:ee().seatsLeafContainer,children:e})},{}):a.jsx("div",{children:" Select Theater and Apply Changes to Select Layout "}),a.jsx("div",{className:ee().cont_screen,children:a.jsx("div",{className:ee().screen,children:a.jsx("span",{className:ee().screen_text,children:"SCREEN"})})})]})})]}),a.jsx(q(),{open:M,onClose:()=>{G(!1)},children:(0,a.jsxs)(m.default,{sx:{...eo,display:"flex",justifyContent:"center",alignItems:"center",width:"600px",maxWidth:"1000px",height:"400px"},children:[eS&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("img",{src:"https://img.freepik.com/vektoren-premium/popcorn-cartoon-maskottchen-weinen-mit-einem-taschentuch_193274-2025.jpg?w=2000",alt:"Sad popcorn",style:{width:"150px",height:"auto",marginBottom:"16px"}}),(0,a.jsxs)(x(),{color:"error",variant:"h6",component:"h2",sx:{mt:2,mb:2,fontFamily:'"Comic Sans MS", cursive, sans-serif'},children:["Oops \uD83D\uDE14 ",eS]})]}),!eS&&(0,a.jsxs)("form",{action:eg,method:"POST",children:[(0,a.jsxs)(m.default,{sx:{display:"flex",justifyContent:"space-between"},children:[a.jsx(x(),{variant:"h6",children:C}),a.jsx($(),{children:a.jsx(F(),{control:a.jsx(L(),{onChange:function(e){e.target.checked?ex("true"):ex("false")}}),label:"Apply Your Rewards: "+e_})})]}),a.jsx(O(),{component:U(),style:{boxShadow:"none"},children:a.jsx(Q(),{sx:{minWidth:550},"aria-label":"simple table",children:(0,a.jsxs)(X(),{children:[(0,a.jsxs)(z(),{children:[a.jsx(V(),{component:"th",scope:"row",children:"Tickets Booked"}),a.jsx(V(),{align:"right",children:K?.ticketsBooked})]}),(0,a.jsxs)(z(),{children:[a.jsx(V(),{component:"th",scope:"row",children:"Cost Per Ticket"}),(0,a.jsxs)(V(),{align:"right",children:["$",K?.pricePerTicket]})]}),(0,a.jsxs)(z(),{children:[a.jsx(V(),{component:"th",scope:"row",children:"Discount"}),a.jsx(V(),{align:"right",children:K?.discount})]}),(0,a.jsxs)(z(),{children:[a.jsx(V(),{component:"th",scope:"row",children:"Tickets Price"}),(0,a.jsxs)(V(),{align:"right",children:["$",K?.totalPrice]})]}),"true"===ep&&(0,a.jsxs)(z(),{children:[a.jsx(V(),{component:"th",scope:"row",children:"Final Price After Rewards"}),(0,a.jsxs)(V(),{align:"right",children:["$",K?.totalPrice-.1*e_>0?K?.totalPrice-.1*e_:"0"]})]})]})})}),a.jsx(B(),{type:"submit",sx:{mt:5},variant:"contained",children:"checkout"})]})]})})]})}},95150:e=>{e.exports={seatsContainer:"Seats_seatsContainer__YZqEG",seatsHolder:"Seats_seatsHolder__f6_kG",seatsLeafContainer:"Seats_seatsLeafContainer__UnyTc",seats:"Seats_seats__5AWnh",colName:"Seats_colName__Oryp_",seatSelected0:"Seats_seatSelected0__ahb4H",seatBlocked:"Seats_seatBlocked__nFpXD",seatBooked:"Seats_seatBooked__fbW_L",disableSeat:"Seats_disableSeat__Dt2Zz",seatSelected:"Seats_seatSelected__VsJHC",paymentButton:"Seats_paymentButton__xsBFD",paymentButtonContainer:"Seats_paymentButtonContainer__6ssQg",cont_screen:"Seats_cont_screen__K93X0",screen:"Seats_screen__9amot",screen_text:"Seats_screen_text__LwBCf"}},47480:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>r,default:()=>o});var a=s(95153);let n=(0,a.createProxy)(String.raw`/Users/sravankumargorati/teamproject-infinite-loop/client/src/app/movies/[movieName]/buyTicket/page.tsx`),{__esModule:r,$$typeof:i}=n,l=n.default,o=l},73881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var a=s(31323);let __WEBPACK_DEFAULT_EXPORT__=e=>{let t=(0,a.fillMetadataSegment)(".",e.params,"favicon.ico");return[{type:"image/x-icon",sizes:"16x16",url:t+""}]}}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[2958,1323,6854,938,1276,7533,6347,4041,7723,3508],()=>__webpack_exec__(76686));module.exports=s})();